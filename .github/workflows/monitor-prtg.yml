# ü§ñ Monitoreo Autom√°tico PRTG - GitHub Actions
#
# Este workflow corre cada 5 minutos para:
# 1. Consultar sensores PRTG de TANDIL y LA MATANZA
# 2. Detectar problemas (DOWN, WARNING, ca√≠das bruscas)
# 3. Enviar alertas por Email y Telegram
# 4. Guardar en Supabase
#
# Corre 24/7 sin necesidad de que nadie tenga la p√°gina abierta

name: Monitoreo PRTG Autom√°tico

on:
  # Ejecutar cada 5 minutos
  schedule:
    - cron: '*/5 * * * *'
  
  # Tambi√©n permitir ejecuci√≥n manual desde GitHub
  workflow_dispatch:

jobs:
  check-alerts:
    runs-on: ubuntu-latest
    
    steps:
      - name: üì• Checkout c√≥digo
        uses: actions/checkout@v4
      
      - name: üü¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: ü§ñ Ejecutar chequeo de alertas
        working-directory: dashboard-usittel
        env:
          VERCEL_PRODUCTION_URL: monitoreo-redes.vercel.app
        run: node scripts/check-alerts-cron.js
      
      - name: ‚úÖ Chequeo completado
        if: success()
        run: echo "‚úÖ Monitoreo ejecutado exitosamente a las $(date)"
      
      - name: ‚ùå Error en chequeo
        if: failure()
        run: echo "‚ùå Error en el monitoreo - revisar logs"
